<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    <title>Hello, world!</title>
  </head>
  <body>
    <!-- <h1>Hello, world!</h1> -->

    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>


    <!-- Include D3.js -->
    <script src="https://d3js.org/d3.v5.min.js"></script>


    <!-- <script src=scripts/process.js></script> -->


    <h1>Loading CSV and processing the data.</h1>
    <p>The data: </p>
    <p>Country: sum, y1990, y2000, y2010, y2013, difference</p>

    <script type="text/javascript">

        //Load in contents of CSV file, and do things to the data.

        var total1990 = 0;
        var total2000 = 0;
        var total2010 = 0;
        var total2013 = 0;

        d3.csv("/csv/data2.csv", function(error, data) {

            if (error) {
                console.log("Had an error loading file.");
            }
            // let's do things to the data here.  This is VERY COMMON in d3 code.
            console.log(data);

            // Your arguments for forEach are the item and it's number in the array:
            data.forEach(function(data_item, index){

                // NB: it's much more common to see (d, i) as shorthand in D3 code.


                // here we are making strings into numbers using type coercion:
                data_item.y1990 = +data_item.y1990;
                data_item.y2000 = +data_item.y2000;
                data_item.y2010 = +data_item.y2010;
                data_item.y2013 = +data_item.y2013;

                // now we add another data object value, a calculated value.
                data_item.difference = data_item.y2013 - data_item.y2010;
                data_item.sum = data_item.y1990 + data_item.y2000 + data_item.y2010 + data_item.y2013

            });

            // Sorting:

            data.sort(function (a, b) {
                return b.sum-a.sum;
            });

            // Suppose you wanted it sorted the other way?  How would you do that?

            console.log("sorted", data);

            d3.select("body").selectAll("p")
            .data(data)
            .enter()
            .append("p")
            .text(function(data_item, index) { return data_item.country + ": " + data_item.sum + " " + data_item.y1990  + " " + data_item.y2000 + " " + data_item.y2010 + " " + data_item.y2013 + " " + data_item.difference; });

        });

    // Notice this below doesn't work.  It's outside the scope of the function that loaded the data.  You need to keep your operations on data inside the loading callback.

    //console.log("my data now", data);

    // what do you expect these values to be now?  what's going on?

    </script>


    <!-- Option 2: jQuery, Popper.js, and Bootstrap JS
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
    -->
  </body>
</html>